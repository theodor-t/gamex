<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Секс-Фанты Адаптив</title>
<style>
  /* --- Сброс --- */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: radial-gradient(circle at center, #1a1a1a, #000);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    gap: 30px;
  }

  /* --- Логи справа --- */
  #logContainer {
    width: 500px;
    background: rgba(255, 0, 100, 0.15);
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(255, 0, 100, 0.3);
    font-size: 14px;
    color: #ff77aa;
    font-weight: 600;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    user-select: none;
    max-height: 90vh;
    position: sticky;
    top: 20px;
    flex-shrink: 0;
  }
  /* Для Webkit-браузеров (Chrome, Safari, Edge) */
#logContainer::-webkit-scrollbar {
  width: 10px;               /* ширина вертикального скролла */
  background: transparent;   /* фон самого скролла */
}

#logContainer::-webkit-scrollbar-track {
  background: rgba(255, 0, 100, 0.1); /* трек — слегка прозрачный */
  border-radius: 10px;
  box-shadow: inset 0 0 10px #ff0066;
}

#logContainer::-webkit-scrollbar-thumb {
  background: linear-gradient(45deg, #ff00aa, #ff3399);
  border-radius: 10px;
  box-shadow:
    0 0 8px #ff3399,
    inset 0 0 6px #ff00aa;
  transition: background 0.3s ease;
}

#logContainer::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(45deg, #ff33cc, #ff66bb);
  box-shadow:
    0 0 12px #ff66bb,
    inset 0 0 8px #ff33cc;
}

/* Для Firefox */
#logContainer {
  scrollbar-width: thin;
  scrollbar-color: #ff3399 rgba(255, 0, 100, 0.1);
}

  #logContainer h3 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #ff0066;
    text-align: center;
    text-shadow: 0 0 10px #ff3399;
  }
  #logList {
    list-style: none;
    padding-left: 10px;
    margin: 0;
    flex-grow: 1;
    display: flex;
    flex-direction: column-reverse;
    overflow-y: auto;
  }
  #logList li {
    margin-bottom: 6px;
    padding: 5px 8px;
    border-radius: 8px;
    background: rgba(255, 0, 100, 0.05);
    box-shadow: inset 0 0 8px rgba(255, 0, 100, 0.2);
    word-break: break-word;
  }
  #logList li:hover {
    background: rgba(255, 0, 100, 0.15);
  }

  /* --- Кнопка показа/скрытия логов (для мобилок) --- */
  #toggleLogBtn {
    display: none; /* будет показана на мобилках */
    margin: 0 auto 10px auto;
    padding: 14px 30px;
    font-size: 20px;
    border-radius: 14px;
    background: #ff0066;
    color: #fff;
    box-shadow: 0 0 12px #ff3399;
    border: none;
    cursor: pointer;
    max-width: 400px;
    width: 100%;
    user-select: none;
    transition: background 0.3s ease;
  }
  #toggleLogBtn:hover {
    background: #ff3399;
  }

  /* --- Основной контейнер игры и настроек --- */
  #mainWrapper {
    max-width: 450px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- Контейнер стартового блока и игры --- */
  #setup, #game {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- Заголовок формы --- */
  #setup h2 {
    margin-bottom: 15px;
  }

  /* --- Инпуты, селекты, кнопки --- */
  input, select, button {
    padding: 14px 18px;
    border-radius: 12px;
    border: none;
    font-size: 18px;
    margin: 8px 0;
    cursor: pointer;
    background: #2c2c2c;
    color: #ff66aa;
    box-shadow: 0 0 8px #ff0066;
    transition: background 0.3s ease, color 0.3s ease;
    width: 100%;
    max-width: 400px;
    box-sizing: border-box;
    text-align: center;
  }
  input:focus, select:focus, button:focus {
    outline: none;
    background: #ff0066;
    color: #fff;
    box-shadow: 0 0 12px #ff3399;
  }

  /* --- Текущий игрок --- */
  #currentPlayer {
    font-size: 24px;
    font-weight: 700;
    padding: 15px 25px;
    border-radius: 16px;
    box-shadow: 0 0 10px #ff0066;
    color: #ff66aa;
    background: #1a001a;
    margin-bottom: 20px;
    cursor: pointer;
    user-select: none;
    width: 100%;
    max-width: 400px;
    text-align: center;
  }

  /* --- Выбор сложности --- */
  #difficultySelect {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  #difficultySelect label {
    cursor: pointer;
    font-weight: 700;
    font-size: 20px;
    user-select: none;
    padding: 12px 30px;
    border-radius: 30px;
    border: 2px solid #ff0066;
    color: #ff66aa;
    background: #1a001a;
    box-shadow: 0 0 8px #ff0066;
    transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    min-width: 90px;
    text-align: center;
  }
  #difficultySelect input[type="radio"] {
    display: none;
  }
  #difficultySelect input[type="radio"]:checked + label {
    background: #ff0066;
    color: #fff;
    box-shadow: 0 0 20px #ff3399;
    border-color: #ff3399;
  }
  #difficultySelect label:hover {
    background: #ff004c;
    color: #fff;
    box-shadow: 0 0 14px #ff66aa;
  }

  /* --- Карточка задания --- */
  #card {
    position: relative;
    width: 100%;
    max-width: 400px;
    min-height: 220px;
    background: linear-gradient(135deg, #2c2c2c, #3d3d3d);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 30px;
    font-size: 24px;
    box-shadow: 0 0 20px rgba(255, 0, 100, 0.4);
    cursor: pointer;
    transition: transform 0.4s ease, background 0.3s ease, opacity 0.4s ease;
    user-select: none;
    margin: 20px auto;
    color: #fff;
    text-shadow: 0 0 10px #ff0066, 0 0 20px #ff0066;
    white-space: pre-wrap;
    opacity: 1;
    overflow: visible;
    z-index: 2;
    border: 2px solid transparent;
  }
  #card.gold {
    background: linear-gradient(135deg, gold, orange);
    color: #000;
    box-shadow: 0 0 40px 8px gold;
    font-weight: bold;
    text-shadow: none;
    animation: pulseGold 2s infinite;
  }
  @keyframes pulseGold {
    0%, 100% { box-shadow: 0 0 40px 8px gold; }
    50% { box-shadow: 0 0 60px 14px gold; }
  }

  /* --- Сердечки и звёздочки анимация --- */
  .floating-effect {
    position: absolute;
    pointer-events: none;
    user-select: none;
    animation: floatUp 3s ease forwards;
    opacity: 0;
  }
  @keyframes floatUp {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translateY(-100px) scale(1.5);
    }
  }

  /* --- Табло очков --- */
  .scoreboard {
    margin-top: 15px;
    font-size: 22px;
    background: rgba(255, 0, 100, 0.2);
    padding: 14px 25px;
    border-radius: 15px;
    box-shadow: 0 0 10px rgba(255, 0, 100, 0.3);
    text-align: center;
    max-width: 400px;
    width: 100%;
    user-select: none;
  }

  /* --- Таймер --- */
  #timerControls {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    max-width: 400px;
    width: 100%;
  }
  #timerControls input[type="number"] {
    width: 90px;
    font-size: 18px;
    padding: 14px;
    border-radius: 12px;
    border: none;
    background: #2c2c2c;
    color: #ff66aa;
  }
  #timerControls button {
    flex-grow: 1;
    max-width: 120px;
    font-size: 18px;
    padding: 14px 10px;
    border-radius: 12px;
    border: none;
    background: #ff0066;
    color: #fff;
    box-shadow: 0 0 12px #ff3399;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #timerControls button:hover {
    background: #ff3399;
  }

  #timerDisplay {
    margin-top: 15px;
    font-size: 28px;
    text-align: center;
    user-select: none;
    font-weight: 700;
  }

  .hidden {
    display: none !important;
  }

  /* --- Адаптив --- */
  @media (max-width: 850px) {
    body {
      flex-direction: column;
    align-items: center;
    padding: 15px 10px;
    gap: 15px;
    }
    #logContainer {
       /* Изменено */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0, 0, 0, 0.95) !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    overflow-y: auto !important;
    z-index: 1000 !important;
    display: none; /* по умолчанию скрыт */
    flex-direction: column !important;
    padding: 50px 20px 20px 20px !important;
  }
      #toggleLogBtn {
    display: block;
    order: 1;
    margin-bottom: 10px;
    width: 100%;
    max-width: 400px;
  }

  #closeLogBtn {
  display: block;          /* чтобы можно было задать margin */
  margin: 10px auto 0;     /* сверху 10px, слева и справа авто — центрирование */
  padding: 8px 16px;       /* чтобы кнопка была удобной */
  cursor: pointer;
  background-color: #ff3366; /* пример цвета */
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  user-select: none;
}
    #mainWrapper {
      max-width: 450px;
      width: 100%;
      padding: 0 10px;
      order: 0;
    }
  }

  @media (max-width: 480px) {
    input, select, button {
      font-size: 20px;
      padding: 16px;
      max-width: 100%;
    }
    #currentPlayer {
      font-size: 26px;
      padding: 18px 30px;
      max-width: 100%;
    }
    #difficultySelect label {
      font-size: 20px;
      padding: 14px 24px;
    }
    #card {
      font-size: 24px;
      min-height: 220px;
    }
    .scoreboard {
      font-size: 22px;
      padding: 16px 20px;
    }
    #timerControls input[type="number"] {
      width: 90px;
      font-size: 18px;
      padding: 14px;
    }
    #timerControls button {
      max-width: 130px;
      font-size: 18px;
      padding: 14px 10px;
    }
    #timerDisplay {
      font-size: 28px;
    }
	.floating-effect {
  position: absolute;
  pointer-events: none;
  user-select: none;
  animation: floatUp 3s ease forwards;
  opacity: 0;
}
@keyframes floatUp {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(-100px) scale(1.5);
  }
}
#card.gold {
  background: linear-gradient(135deg, gold, orange);
  color: #000;
  box-shadow: 0 0 40px 8px gold;
  font-weight: bold;
  text-shadow: none;
  animation: pulseGold 2s infinite;
}
@keyframes pulseGold {
  0%, 100% { box-shadow: 0 0 40px 8px gold; }
  50% { box-shadow: 0 0 60px 14px gold; }
}
  }
</style>
</head>
<body>
<div id="mainWrapper">
  <div id="setup">
    <h2>Начать игру</h2>
    <input type="text" id="player1Name" placeholder="Имя Игрока 1" />
    <select id="player1Gender">
      <option value="male">Мужчина</option>
      <option value="female">Женщина</option>
    </select>
    <input type="text" id="player2Name" placeholder="Имя Игрока 2" />
    <select id="player2Gender">
      <option value="male">Мужчина</option>
      <option value="female">Женщина</option>
    </select>
    <input type="password" id="secretCode" placeholder="Пароль для секретных заданий (необязательно)" />
    <button id="startGame">Начать игру</button>
  </div>

  <div id="game" class="hidden">
    <select id="currentPlayer"></select>
    <div id="difficultySelect">
      <input type="radio" name="difficulty" id="diffEasy" value="easy" checked />
      <label for="diffEasy">Легко</label>
      <input type="radio" name="difficulty" id="diffMedium" value="medium" />
      <label for="diffMedium">Средне</label>
      <input type="radio" name="difficulty" id="diffHard" value="hard" />
      <label for="diffHard">Сложно</label>
    </div>
    <div class="scoreboard" id="scoreBoard"></div>
    <div id="card" tabindex="0">❤️</div>
    <div id="timerControls">
      <input type="number" id="minutes" placeholder="Минуты" min="0" />
      <input type="number" id="seconds" placeholder="Секунды" min="0" max="59" />
      <button id="startTimerBtn">Старт</button>
      <button id="resetTimerBtn">Сброс</button>
    </div>
    <div id="timerDisplay"></div>
    <button id="toggleLogBtn">ЛОГИ</button>
  </div>
</div>
<div id="logContainer">
  <button id="closeLogBtn" aria-label="Закрыть логи">✕ Закрыть</button>
  <h3>Лог заданий</h3>
  <ul id="logList"></ul>
</div>

<script>
function getFreshUsedTasks() {
  return {
    male: { easy: [], medium: [], hard: [] },
    female: { easy: [], medium: [], hard: [] }
  };
}

const tasks = {
  male: {
    easy: ["Сними одежду и стань на колени", "Поцелуй её ноги", "Прошепчи похоть на ухо"],
    medium: ["Сделай массаж груди партнёрше", "Сними с неё одежду зубами"],
    hard: ["Свяжи партнёршу и возьми под контроль", "Сделай кунилингус 5 минут"]
  },
  female: {
    easy: ["Сядь партнёру на колени и поцелуй в шею", "Покажи ему нижнее бельё"],
    medium: ["Проведи рукой по его груди медленно", "Прошепчи фантазию"],
    hard: ["Сделай стриптиз", "Сделай ему минет без рук 3 минуты"]
  },
  special: ["Сделайте 69", "Занимайтесь сексом стоя у стены"]
};

const tasksSecret = {
  male: {
  easy: [
    "Сними одежду и стань на колени", "Прошепчи похоть на ухо", "Поцелуй партнёршу в шею",
    "Ласково скажи, чего хочешь прямо сейчас", "Обними партнёршу сзади и прижмись",
    "Погладь её бедро, глядя в глаза", "Дотронься губами до её живота", 
    "Пройдись пальцами от шеи до поясницы", "Сними с неё одну деталь одежды", 
    "Покажи, как ты возбуждён, не касаясь себя", "Прошепчи в ухо свою фантазию",
    "Покажи язык и обведи им губы", "Лизни её шею", "Потрогай её грудь через одежду",
    "Сядь рядом и прижмись бедром", "Сними футболку, медленно", "Скажи ей, как она тебя заводит",
    "Проведи пальцем по её спине", "Положи её руку себе в штаны", "Обними за талию и прижми к себе",
    "Покажи киску пальцем, не касаясь", "Дотронься губами до её сосков через одежду",
    "Погладь внутреннюю сторону её бедра", "Сделай лёгкий укус за мочку уха",
    "Скажи ей пошлость, шепотом", "Сними брюки, оставив нижнее белье",
    "Погладь себя перед ней, не раздеваясь", "Поцелуй её в живот", "Сделай короткий массаж её ягодиц"
  ],
  medium: [
    "Сними с неё одежду зубами", "Сделай массаж груди партнёрше", "Положи её руку на свой член",
    "Заставь её стонать от поцелуев", "Протри своим членом её ягодицы",
    "Поцелуй её соски", "Покажи, как ты дрочишь перед ней", 
    "Сними трусы с неё медленно", "Окунись лицом в её грудь", "Проведи членом по её спине",
    "Сделай массаж её попки", "Двигайся, терясь об неё, не проникая", 
    "Заложи её руки за спину и прижми", "Сделай куннилингус 1 минуту",
    "Сядь на колени перед ней и поцелуй между ног", "Пройдись языком по внутренней стороне её бедра",
    "Придержи её голову, пока целуешь шею", "Сделай ей приятно рукой", 
    "Оближи её соски", "Обними её сзади и потри своим членом об её ягодицы",
    "Сними нижнее белье и покажи член", "Возьми её руку и проведи по своему члену",
    "Притяни её за волосы и прошепчи желание", "Прикуси её соски",
    "Поставь её на колени и посмотри в глаза", "Дай ей пощёчину по попке",
    "Прижми к стене и терись членом о живот", "Сделай массаж с маслом на груди", "Скажи: «Сделай со мной, что хочешь»"
  ],
  hard: [
    "Сделай кунилингус 5 минут", "Свяжи партнёршу и возьми под контроль",
    "Вставь ей анальную пробку", "Прижми её к кровати и контролируй",
    "Дай ей себя отсосать, глядя ей в глаза", "Возьми её за горло и поцелуй",
    "Заставь её мастурбировать перед тобой", "Сделай куннилингус, пока она сидит на твоём лице",
    "Засними, как она сосёт, на видео", "Проведи членом по её лицу",
    "Сядь ей на грудь и терись членом", "Вставь член между её грудей и двигай",
    "Отшлёпай её попку, пока она стоит на коленях", "Сделай ей приятно пальцами до оргазма",
    "Протри членом её губы", "Сделай куннилингус в позе 69",
    "Оближи её киску после того, как она кончит", "Поставь её на колени перед зеркалом",
    "Дай команду показать киску и подойти", "Возьми её руку и заставь облизать после мастурбации",
    "Поставь её в позу и терись о киску без проникновения", 
    "Проведи членом по её соскам", "Положи её голову себе на член", 
    "Сними видео, как она тебя трогает", "Потрогай её киску под водой (если рядом ванна)",
    "Засунь пальцы ей в киску и облизни потом", "Сделай куни, пока она держит тебя за волосы",
    "Проведи членом по её анусу", "Удерживай её, пока целуешь киску"
  ]
},
female: {
  easy: [
    "Сядь к партнёру на колени и поцелуй в шею", "Покажи ему нижнее бельё", "Прошепчи похоть ему в ухо",
    "Проведи рукой по его бедру", "Сними верхнюю одежду медленно",
    "Обними и прижмись грудью", "Сделай вид, что хочешь поцелуй, но не давай",
    "Покажи, как трогаешь себя через одежду", "Присядь на корточки перед ним",
    "Скажи: «Я хочу тебя прямо сейчас»", "Проведи пальцем по его губам",
    "Положи его руку себе на грудь", "Поцелуй его грудь", 
    "Погладь себя при нём", "Сними лифчик (можно прикрывшись)",
    "Покажи соски на секунду", "Сядь на него и двигайся без проникновения",
    "Обними за шею и потри грудью", "Залезь ему на спину и шепчи",
    "Проведи языком по своей губе", "Прошепчи фантазию", 
    "Покажи киску на секунду", "Сядь между его ног и поцелуй живот",
    "Ласково укуси за ухо", "Положи его руку себе между ног",
    "Проведи языком по его животу", "Покажи киску через зеркало", 
    "Покажи грудь и скажи: «Они для тебя»", "Сядь у него между ног и поглаживай грудь"
  ],
  medium: [
    "Сделай стриптиз", "Сделай ему минет без рук 3 минуты", 
    "Сядь на его лицо", "Покажи киску и проведи по ней пальцем", 
    "Лизни его соски", "Поцелуй его член сверху до низа",
    "Сделай вид, что хочешь кончить, но остановись", 
    "Мастурбируй при нём", "Проведи членом по лицу", 
    "Сделай вид, что начинаешь минет, но задержись",
    "Оближи его член по кругу", "Положи его член между грудей",
    "Проведи языком от живота до члена", "Оближи яйца", 
    "Сядь сверху и двигайся, не проникая", 
    "Сделай глоток спермы и покажи язык", 
    "Придержи его за яйца во время минета", "Попроси его кончить на грудь",
    "Оближи член и скажи: «Ты мой»", "Покажи, как трогаешь киску перед ним",
    "Сядь на колени и лизни член", "Окунись в его пах лицом",
    "Поцелуй яйца", "Обними член грудью и двигай",
    "Оближи головку члена медленно", "Приди к нему голой под простынёй",
    "Скажи: «Я хочу твой член в себе»", "Попроси его кончить в рот", "Сними видео, как ты мастурбируешь"
  ],
  hard: [
    "Сделай глубокий минет", "Глоти сперму и покажи язык",
    "Попроси его кончить тебе на лицо", "Сделай минет и скажи, как он на вкус",
    "Сядь на его лицо и удерживай", "Покажи киску и скажи: «Возьми меня»",
    "Вставь анальную пробку и покажи", "Протри киской по его члену",
    "Положи его член на лицо и облизни", "Оближи сперму с его живота",
    "Сними видео, как кончаешь", "Сделай фото с членом во рту",
    "Сделай фото с яйцами во рту", "Мастурбируй ему, пока не кончит",
    "Вставь анальную пробку и сядь на него", "Сделай минет, пока он записывает",
    "Оставь след от спермы на лице", "Лизни член после оргазма",
    "Скажи: «Я твоя шлюха» и облизни яйца", "Засними, как ты принимаешь сперму в рот",
    "Лизни киску после оргазма (если обе женщины)", "Сделай минет в позе 69",
    "Сядь сверху, управляй и смотри в глаза", "Прижми грудь к его члену и двигай",
    "Протри киской по его лицу", "Скажи, что хочешь сперму внутрь",
    "Оближи член после того, как он кончил", "Сними видео, как ты кончаешь ему на член", "Сядь на него и поцелуй, не двигаясь"
  ]
},
special: [
  "Сделайте 69", "Занимайтесь сексом стоя у стены", 
  "Поменяйтесь ролями и делайте друг другу куннилингус / минет",
  "Он сидит, она сверху — двигайтесь без проникновения", 
  "Лягте рядом и трогайте друг друга до оргазма",
  "Запишите короткое видео 5 сек, как вы ласкаетесь",
  "Она трётся киской об его живот", 
  "Он трётся членом о её грудь", 
  "Сядьте лицом к лицу и целуйтесь 3 минуты без остановки",
  "Она лижет его яйца, он гладит её киску", 
  "Он делает куни, она мастурбирует ему",
  "Она сосёт, он ласкает её анус", 
  "Сделайте фото, где она держит член губами",
  "Она садится сверху, он держит за талию и теряется",
  "Сядьте в позу ложки и тритесь",
  "Сядьте в позу лотоса и поцелуйтесь глубоко",
  "Она сидит на лице, он держит ягодицы",
  "Он делает куни, она гладит его волосы",
  "Он шлёпает по киске, она шлёпает по члену",
  "Выполните по одному заданию из уровня выше",
  "Сделайте друг другу приятно одновременно руками",
  "Снимите друг друга на камеру, как ласкаете",
  "Он кончает ей на грудь — она облизывает",
  "Она сосёт член — он трёт её киску",
  "Он держит её голову — она делает минет",
  "Сделайте всё, что хотите, 1 минута на фантазию",
  "Она трётся грудью об его лицо",
  "Он вставляет пробку — она показывает в зеркало",
  "Сядьте перед зеркалом и мастурбируйте вместе",
  "Он лижет анус — она целует член"
]};

let currentTasks = tasks;
let usedTasks = getFreshUsedTasks();
let players = {};
const score = { player1: 0, player2: 0 };

const currentPlayerSelect = document.getElementById("currentPlayer");
const card = document.getElementById("card");
const scoreBoard = document.getElementById("scoreBoard");
const logContainer = document.getElementById("logContainer");
const logList = document.getElementById("logList");
const toggleLogBtn = document.getElementById("toggleLogBtn");
const closeLogBtn = document.getElementById("closeLogBtn");
const timerDisplay = document.getElementById("timerDisplay");

let timerInterval = null;
let timerEndTime = null;

function addLog(msg) {
  const li = document.createElement("li");
  li.textContent = msg;
  logList.prepend(li);
  if (logList.children.length > 100) logList.removeChild(logList.lastChild);
}

function getRandomTask(gender, difficulty) {
  const arr = currentTasks[gender][difficulty];
  const used = usedTasks[gender][difficulty];
  if (used.length >= arr.length - 1) used.splice(0, 1);
  let task;
  let attempts = 0;
  do {
    task = arr[Math.floor(Math.random() * arr.length)];
    attempts++;
  } while (used.includes(task) && attempts < 10);
  used.push(task);
  return task;
}

function animateCardChange(newText, isSpecial) {
  card.style.opacity = "0";
  card.style.transform = "scale(0.8)";
  setTimeout(() => {
    card.textContent = newText + (isSpecial ? " 🔞" : "");
    card.classList.toggle("gold", isSpecial);
    card.style.opacity = "1";
    card.style.transform = "scale(1)";
    for (let i = 0; i < 7; i++) {
      const isHeart = Math.random() < 0.5;
      createFloatingEffect(isHeart ? "❤️" : "✨", isHeart ? "#ff3366" : "#fff9a6");
    }
  }, 400);
}

function createFloatingEffect(char, color) {
  const effect = document.createElement("div");
  effect.textContent = char;
  effect.className = "floating-effect";
  effect.style.color = color;
  effect.style.left = Math.random() * 80 + 10 + "%";
  effect.style.top = "90%";
  effect.style.fontSize = (Math.random() * 24 + 20) + "px";
  effect.style.animationDelay = (Math.random() * 0.5) + "s";
  effect.style.zIndex = 5;
  card.appendChild(effect);
  setTimeout(() => effect.remove(), 3000);
}

function showNextTask() {
  const playerKey = currentPlayerSelect.value;
  const player = players[playerKey];
  if (!player) return;
  const difficulty = document.querySelector("input[name='difficulty']:checked").value;
  let task = getRandomTask(player.gender, difficulty);
  const isSpecial = Math.random() < 0.05;
  if (isSpecial) {
    const arr = currentTasks.special;
    task = arr[Math.floor(Math.random() * arr.length)];
  }
  animateCardChange(task, isSpecial);
  addLog(`${player.name} (${difficulty}): ${task}`);
}

function updateScoreboard() {
  scoreBoard.innerHTML = `
    <b>${players.player1.name}:</b> ${score.player1} &nbsp;&nbsp;
    <b>${players.player2.name}:</b> ${score.player2}`;
}

function startGame() {
  const p1 = document.getElementById("player1Name").value || "Игрок 1";
  const p2 = document.getElementById("player2Name").value || "Игрок 2";
  const g1 = document.getElementById("player1Gender").value;
  const g2 = document.getElementById("player2Gender").value;
  const pass = document.getElementById("secretCode").value.trim();
  currentTasks = (pass === "sexgame1234") ? tasksSecret : tasks;
  usedTasks = getFreshUsedTasks();
  players = {
    player1: { name: p1, gender: g1, score: 0 },
    player2: { name: p2, gender: g2, score: 0 }
  };
  score.player1 = 0;
  score.player2 = 0;
  currentPlayerSelect.innerHTML = "";
  Object.entries(players).forEach(([key, p]) => {
    const opt = document.createElement("option");
    opt.value = key;
    opt.textContent = p.name;
    currentPlayerSelect.appendChild(opt);
  });
  document.getElementById("setup").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  showNextTask();
  updateScoreboard();
  addLog(`Начало игры: ${p1} и ${p2}`);
}

currentPlayerSelect.addEventListener("change", showNextTask);
card.addEventListener("click", () => {
  const playerKey = currentPlayerSelect.value;
  if (!playerKey) return;
  score[playerKey]++;
  updateScoreboard();
  showNextTask();
});
document.getElementById("startGame").addEventListener("click", startGame);

document.getElementById("startTimerBtn").addEventListener("click", () => {
  clearInterval(timerInterval);
  const m = parseInt(document.getElementById("minutes").value) || 0;
  const s = parseInt(document.getElementById("seconds").value) || 0;
  let total = m * 60 + s;
  if (total <= 0) return;
  timerEndTime = Date.now() + total * 1000;
  updateTimerDisplay(total);
  timerInterval = setInterval(() => {
    const left = Math.max(0, Math.round((timerEndTime - Date.now()) / 1000));
    updateTimerDisplay(left);
    if (left <= 0) {
      clearInterval(timerInterval);
      alert("Время вышло!");
    }
  }, 250);
});

function updateTimerDisplay(s) {
  const m = Math.floor(s / 60);
  timerDisplay.textContent = `${m.toString().padStart(2, "0")}:${(s % 60).toString().padStart(2, "0")}`;
}

document.getElementById("resetTimerBtn").addEventListener("click", () => {
  clearInterval(timerInterval);
  timerDisplay.textContent = "";
  document.getElementById("minutes").value = "";
  document.getElementById("seconds").value = "";
});

function checkScreenSize() {
  if (window.innerWidth > 850) {
    logContainer.style.display = "flex";
    toggleLogBtn.style.display = "none";
    closeLogBtn.style.display = "none"; // скрыть кнопку закрытия на ПК
    document.body.style.overflow = ""; // разрешить скролл страницы
  } else {
    logContainer.style.display = "none";
    toggleLogBtn.style.display = "block";
    closeLogBtn.style.display = "block"; // показать кнопку закрытия на мобильных
    document.body.style.overflow = ""; // разрешить скролл страницы
  }
}

toggleLogBtn.addEventListener("click", () => {
  const isVisible = logContainer.style.display === "flex";
  if (isVisible) {
    logContainer.style.display = "none";
    document.body.style.overflow = ""; // разрешить скролл страницы
  } else {
    logContainer.style.display = "flex";
    document.body.style.overflow = "hidden"; // запретить скролл страницы
    logContainer.scrollTop = logContainer.scrollHeight; // прокрутить вниз
  }
});

closeLogBtn.addEventListener("click", () => {
  logContainer.style.display = "none";
  document.body.style.overflow = ""; // разрешить скролл страницы
});

window.addEventListener("resize", checkScreenSize);
window.addEventListener("load", checkScreenSize);
</script>

</body>
</html>